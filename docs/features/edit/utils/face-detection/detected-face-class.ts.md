# detected-face-class.ts

## DetectedFace (クラス)
- 概要
> 入力された顔の情報を保持、抽出するためのクラス。
> 抽出処理に用いるモデルは全て各モデルのラッパーから利用する。

### コンストラクタ
- 概要
> またこのクラスは一度画像が代入されると、画像は変更されないものと想定されている。
> 入力された顔からパーツを抽出。
> パーツの右(`right`)、左(`left`)は検出対象の顔、つまり本人の視点からの判断にする。
> 元の画像をバウンディングボックスの範囲でROI処理。
> インスタンス生成時にモデルラッパーの`useFaceLandmarker`メソッドで顔のパーツを検出しておく。
> 涙袋はモデルの推論完了後に専用のワーカーで目元の明暗の境界から検出する。
> 顔の全てのランドマークの検出後にパーツごとにワーカーを立ち上げ、周囲との色の変化(周囲との数値の比較で突出した部分)や座標分布の変化予測(微分積分など)などから境界線を微細化し、座標情報の精度を上げる。
> 検出されたパーツの座標は、バウンディングボックス内の座標から元の画像の座標に変換し、プライベート変数に保存。
> 初期化、または処理が失敗した場合は、プライベート変数に`false`を代入する。

- 引数
> 第1引数: 検出元の画像(`ImageData`型)  
> 第2引数: モデルラッパーの`usePersonDetector`メソッドで返されたオブジェクトの対象の顔のバウンディングボックス
>   
> ```typescript
> ImageData, // 第1引数
> [x, y, width, height] // 第2引数
> ```

---

### getSegmented (メソッド)
- 概要
> クラス内のプライベート変数が保持している元画像を返す。

- 引数
> 第1引数: なし

- 返り値
> 元画像
> 
> ```typescript
> ImageData // インスタンス生成時に渡されたものをそのまま返す
> ```

---

### getBbox (メソッド)
- 概要
> クラス内のプライベート変数が保持しているバウンディングボックスを返す。

- 引数
> 第1引数: なし

- 返り値
> バウンディングボックスの座標
> 
> ```typescript
> [x, y, width, height] // インスタンス生成時に渡されたものをそのまま返す
> ```

---

### hasProcessed (メソッド)
- 概要
> 顔のパーツの検出が完了したかを返す。

- 引数
> 第1引数: なし

- 返り値
> 処理が完了したかを表す`Bool`値
>   
> ```typescript
> true
> ```

---

### getFaceAngle (メソッド)
- 概要
> 顔の傾き(角度)を返す。
> ランドマーク検出が終わってなかったら例外を返す。
> 元になるランドマークが見つからなかったら(`false`が返されたら)例外を返す。

- 引数
> 第1引数: なし

- 返り値
> 小数を含む顔の軸ごと(X, Y, Z)の傾きの角度(-180° ~ 180°)
>   
> ```typescript
> -21.865,
> 10,
> -2.562
> ```

- 例外
> `ランドマークの処理が終わっていません`
> `元になるランドマークが見つかりません`

---

### isFaceTouched (メソッド)
- 概要
> 入力された元の画像の座標が、このオブジェクトの保持している顔(Face Landmarkerモデルで検出した顔の輪郭の内側)の範囲内かを判別する。
> ランドマーク検出が終わってなかったら例外を返す。
> 元になるランドマークが見つからなかったら(`false`が返されたら)例外を返す。

- 引数
> 第1引数: 座標の配列
> >
> 例:
> ```typescript
>   [20, 60]
> ```

- 返り値
> 入力された座標が顔に重なっているかの`Bool`値
>   
> ```typescript
> true
> ```

- 例外
> `ランドマークの処理が終わっていません`
> `元になるランドマークが見つかりません`

---

### getContour (メソッド)
- 概要
> クラス内のプライベート変数が保持している顔の輪郭の座標を返す。
> ランドマーク検出が終わってなかったら例外を返す。
> 元になるランドマークが見つからなかったら(`false`が返されたら)例外を返す。

- 引数
> 第1引数: なし

- 返り値
> 検出された顔の輪郭の座標の配列
>   
> ```typescript
> [[0, 0, 0], [1, 2, 1], [5, 8, 2]...]
> ```

- 例外
> `ランドマークの処理が終わっていません`
> `元になるランドマークが見つかりません`

---

### getEyes (メソッド)
- 概要
> クラス内のプライベート変数が保持している左右の目の縁(目と肌の境目)の座標を、`left`と`right`のキーを持つ辞書に、左右それぞれの座標の配列を入れて返す。
> ランドマーク検出が終わってなかったら例外を返す。
> 元になるランドマークが見つからなかったら(`false`が返されたら)例外を返す。

- 引数
> 第1引数: なし

- 返り値
> 左右の目の縁の座標が入った配列を持つ辞書
> 
> ```typescript
> {
>   "left": [[0, 0, 2], [1, 2, 2], [3, 7, 4]...]
>   "right": [[0, 0, 2], [1, 2, 3], [3, 7, 6]...]
> }
> ```

- 例外
> `ランドマークの処理が終わっていません`
> `元になるランドマークが見つかりません`

---

### getNose (メソッド)
- 概要
> クラス内のプライベート変数が保持している肌と鼻の境界線の座標の配列を返す。
> ランドマーク検出が終わってなかったら例外を返す。
> 元になるランドマークが見つからなかったら(`false`が返されたら)例外を返す。

- 引数
> 第1引数: なし

- 返り値
> 鼻の縁(鼻と肌の境目)の座標の配列
>   
> ```typescript
> [[0, 0, 2], [1, 2, 5], [5, 8, 6]...]
> ```

- 例外
> `ランドマークの処理が終わっていません`
> `元になるランドマークが見つかりません`

---

### getMouth (メソッド)
- 概要
> クラス内のプライベート変数が保持している肌と口の境界線の座標の配列を返す。
> ランドマーク検出が終わってなかったら例外を返す。
> 元になるランドマークが見つからなかったら(`false`が返されたら)例外を返す。

- 引数
> 第1引数: なし

- 返り値
> 口の縁(口と肌の境目)の座標の配列
>   
> ```typescript
> [[100, 20, 30], [110, 22, 32], [115, 28, 35]...]
> ```

- 例外
> `ランドマークの処理が終わっていません`
> `元になるランドマークが見つかりません`

---

### getEyebrows (メソッド)
- 概要
> クラス内のプライベート変数が保持している左右の眉毛の上下を含めた全体の縁(眉毛と肌の境目)の座標を、`left`と`right`のキーを持つ辞書に、左右それぞれの座標の配列を入れて返す。
> ランドマーク検出が終わってなかったら例外を返す。
> 元になるランドマークが見つからなかったら(`false`が返されたら)例外を返す。

- 引数
> 第1引数: なし

- 返り値
> 左右の眉毛の縁の座標が入った配列を持つ辞書
> 
> ```typescript
> {
>   "left": [[10, 5, 1], [11, 7, 2], [13, 7, 2]...]
>   "right": [[20, 5, 2], [23, 5, 3], [24, 7, 2]...]
> }
> ```

- 例外
> `ランドマークの処理が終わっていません`
> `元になるランドマークが見つかりません`


---

### getEyebags (メソッド)
- 概要
> クラス内のプライベート変数が保持している左右の涙袋の縁(涙袋と肌の境目)の座標を、`left`と`right`のキーを持つ辞書に、左右それぞれの座標の配列を入れて返す。
> ランドマーク検出が終わってなかったら例外を返す。
> 元になるランドマークが見つからなかったら(`false`が返されたら)例外を返す。

- 引数
> 第1引数: なし

- 返り値
> 左右の涙袋の縁の座標が入った配列を持つ辞書
> 
> ```typescript
> {
>   "left": [[11, 10, 1], [11, 9, 2], [13, 8, 2]...]
>   "right": [[20, 10, 2], [23, 8, 3], [24, 8, 2]...]
> }
> ```

- 例外
> `ランドマークの処理が終わっていません`
> `元になるランドマークが見つかりません`

---

### getHair (メソッド)
- 概要
> クラス内のプライベート変数が保持している髪の縁(髪と背景または肌の境目)の座標を配列を入れて返す。
> ランドマーク検出が終わってなかったら例外を返す。
> 元になるランドマークが見つからなかったら(`false`が返されたら)例外を返す。

- 引数
> 第1引数: なし

- 返り値
> 髪の縁の座標が入った配列
> 
> ```typescript
> [[11, 10, 1], [30, 20, 1], [43, 23, 1]]
> ```

- 例外
> `ランドマークの処理が終わっていません`
> `元になるランドマークが見つかりません`

---

### getIris (メソッド)
- 概要
> クラス内のプライベート変数が保持している左右の虹彩の縁(虹彩と白目の境目)の座標を、`left`と`right`のキーを持つ辞書に、左右それぞれの座標の配列を入れて返す。
> ランドマーク検出が終わってなかったら例外を返す。
> 元になるランドマークが見つからなかったら(`false`が返されたら)例外を返す。

- 引数
> 第1引数: なし

- 返り値
> 左右の虹彩の縁の座標が入った配列を持つ辞書
> 
> ```typescript
> {
>   "left": [[11, 10, 1], [11, 9, 2], [13, 8, 2]...]
>   "right": [[20, 10, 2], [23, 8, 3], [24, 8, 2]...]
> }
> ```

- 例外
> `ランドマークの処理が終わっていません`
> `元になるランドマークが見つかりません`